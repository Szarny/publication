---
title: 令和元年度 秋季 情報処理安全確保支援士試験 午後Ⅰ問題
---

# はじめに
&nbsp;&nbsp;&nbsp;本記事では、「令和元年度 秋季 情報処理安全確保支援士試験 午後Ⅰ問題」の解説を行います。

&nbsp;&nbsp;&nbsp;問題文へのリンクは [本記事では、「令和元年度 秋季 情報処理安全確保支援士試験 午後Ⅰ問題](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2019h31_2/2019r01a_sc_pm1_qs.pdf) からどうぞ。

# 問1 電子メールのセキュリティ対策
## 設問1
&nbsp;&nbsp;&nbsp;メールの送信元であるFROMアドレスには、いわゆる一般的なメールクライアント上で表示されるようなHeader-FROMアドレスと、メール配送に関する問題が発生した際の返送先となるEnvelope-FROMアドレスの2種類があります(TOアドレスも同様に2種類存在します)。

さて、SMTPコマンドを用いてメールを送信する際の流れの一例を以下に示します。

```
EHLO <SMTP ClientのFQDN>
MAIL FROM: <Envelope-FROMアドレス>
RCPT TO: <Envelope-TOアドレス>
DATA
<メール本文>
.
QUIT
```

&nbsp;&nbsp;&nbsp;上記から分かるように、Envelope-FROMアドレスの指定にあたっては`MAIL FROM`コマンドを利用します。

&nbsp;&nbsp;&nbsp;よって、空欄aには**MAIL FROM**が入ります。

## 設問2
### (1)
&nbsp;&nbsp;&nbsp;SPF(Sender Policy Framework)は、電子メールにおける送信元ドメインの認証技術です。具体的には、以下のように送信元ドメインの認証が行われます。

- 送信側は、自ドメインを管理するDNSサーバのSPFレコードにメールの送信元として有効であるサーバのIPアドレスを登録する。
- 受信側は、受信したメールの送信元アドレスに対応するDNSサーバへSPFレコードを問い合わせ、登録されているIPアドレスと一致するかどうか検証する。

&nbsp;&nbsp;&nbsp;上記の流れを考慮すると、SPFによる認証を行うには以下の条件が必要です。

- 送信側のDNSサーバにSPFレコードが登録されている。
- 受信側のメールサーバでSPFの検証が行われている。

&nbsp;&nbsp;&nbsp;さて、図3に示されている攻撃を簡潔にまとめると以下のようになります。

- `攻撃1` N社でのなりすましメールの**受信**。
- `攻撃2` N社を起点とするなりすましメールの**送信**。

&nbsp;&nbsp;&nbsp;まず、項番4について考えます。

- 攻撃1(受信)は防げません。なぜなら、取引先のDNSサーバはSPFへの対応を行なっていないため、N社のメールサーバにおいてSPFレコードの検証ができないからです。よって空欄bは**×**です。
- 攻撃2(送信)も防げません。なぜなら、取引先のメールサーバはSPFの検証を行わないからです。よって空欄cは**×**です。

&nbsp;&nbsp;&nbsp;次に、項番6について考えます。

- 攻撃1(受信)は防げません。なぜなら、N社のメールサーバはSPFの検証を行わないからです。よって空欄dは**×**です。
- 攻撃2(送信)も防げません。なぜなら、取引先のメールサーバはSPFの検証を行わないからです。よって空欄eは**×**です。

&nbsp;&nbsp;&nbsp;次に、項番7について考えます。

- 攻撃1(受信)は防げません。なぜなら、N社のメールサーバはSPFの検証を行わない上に、取引先のDNSサーバはSPFへの対応を行なっていないからです。よって空欄fは**×**です。
- 攻撃2(送信)は防ぐことができます。なぜなら、N社のDNSサーバはSPFへの対応を行なっており、かつ取引先のメールサーバはSPFの検証を行うからです。よって空欄gは**◯**です。

&nbsp;&nbsp;&nbsp;最後に、項番13について考えます。

- 攻撃1(受信)は防げません。なぜなら、N社のメールサーバはSPFの検証を行わないからです。よって空欄hは**×**です。
- 攻撃2(送信)も防げません。なぜなら、N社のDNSサーバはSPFへの対応を行なっていないため、取引先のメールサーバにおいてSPFレコードの検証ができないからです。よって空欄iは**×**です。

### (2)
&nbsp;&nbsp;&nbsp;SPFレコードは、DNSにおいてTXTレコードとして公開します(SPFレコードも存在しますが、互換性等の関係でTXTレコードが用いられることが一般的です)。

&nbsp;&nbsp;&nbsp;SPFレコードの書式は以下の通りです。

```
<FQDN> IN TXT "<バージョン> <定義>"
e.g. example.com. IN TXT "v=spf1 -all"
```

&nbsp;&nbsp;&nbsp;このうち、バージョンは問題文の`v=spf1`の部分です。

&nbsp;&nbsp;&nbsp;さて、肝心の定義の部分は`+ip4:[ j ] -all`と記述されています。

&nbsp;&nbsp;&nbsp;このうち、`-all`とは「設定された以外のアドレスを当該ドメインのメールサーバとして一切認証しない」という設定です(ちなみに、正当なメールであっても認証に失敗する恐れがあることを示すための`~all`といった緩めの設定もあり、これはSoftFailと呼ばれます)。

&nbsp;&nbsp;&nbsp;前半の部分は`ip4:`と書かれていることからわかるように、IPv4のIPアドレスを設定します。図2からわかるように、N社のグローバルIPアドレスは`x1.y1.z1.1`であるため、空欄jは**x1.y1.z1.1**です。

### (3)
&nbsp;&nbsp;&nbsp;「... (メールが転送される) その間でSPFに対応している別のメールサーバがEnvelope-FROMを変えずにメールをそのまま転送する場合は、メール受信側のメールサーバにおいて、SPF認証が失敗してしまう」理由について考えます。

&nbsp;&nbsp;&nbsp;問題を簡潔に捉えるために、以下のような場合を想定します。なお、各サーバはカッコ内に示すSPFレコードを適切にDNSサーバへ登録しているものとします。

```
[ メールサーバA ] a.com (v=spf1 +ip4:x.y.z.1 -all)
       |
       |
[ メールサーバB ] b.com (v=spf1 +ip4:x.y.z.2 -all)
       |
       |
[ メールサーバC ] c.com (v=spf1 +ip4:x.y.z.3 -all)
```

&nbsp;&nbsp;&nbsp;ここで、`foo@a.com`から`bar@b.com`にメールを送信すると`bar@c.com`に転送されるとします。

&nbsp;&nbsp;&nbsp;まず、メールをメールサーバAからメールサーバBに送信します。そうすると、メールサーバBはSPFの検証に成功します。なぜなら、Envelope-FROMのアドレスが`x.y.z.1`であり、かつSMTP接続元IPアドレスにおけるDNSサーバのSPFレコードの値(`x.y.z.1`)が一致するからです。

&nbsp;&nbsp;&nbsp;次に、メールはメールサーバBからメールサーバCに転送されます。ここで、メールサーバCはSPFの検証に失敗します。なぜなら。転送を行うメールサーバがEnvelope-FROMの値を変えないために、Envelope-FROMのアドレスは`x.y.z.1`のままになるからです。そのため、SMTPの接続元IPアドレスにおけるDNSサーバのSPFレコードの値(`x.y.z.2`)とは一致しません。

&nbsp;&nbsp;&nbsp;よって、本問の理由は「**送信側のDNSサーバに設定されたIPアドレスとSMTP接続元のIPアドレスが一致しないから**」だと言えます。

### (4)
&nbsp;&nbsp;&nbsp;「... メール本文とメールヘッダをもとに生成したハッシュ値を用いて、DKIM-Signatureヘッダに付与されているディジタル署名を検証する」ことによって、メールの送信元の正当性以外に確認できる事項を考えます。

&nbsp;&nbsp;&nbsp;ディジタル署名は、メール本文とメールヘッダをもとに生成したハッシュ値を送信者の秘密鍵で署名したものです。つまり、送信者の本当の秘密鍵で署名されていなかったり、メール本文とメールヘッダがハッシュ値生成時の内容から変更されていたりすると受信側で検証に失敗します。

&nbsp;&nbsp;&nbsp;このうち、「メールの送信元の正当性」は「送信者の本当の秘密鍵で署名されたかどうか」によって確認できます。

&nbsp;&nbsp;&nbsp;では「メール本文とメールヘッダがハッシュ値生成時の内容から変更されていないかどうか」によって確認できることはなんでしょうか。それは「メール本文とメールヘッダが改ざんされていないこと」だと言えます。

&nbsp;&nbsp;&nbsp;よって、本問の答えは「**メール本文及びメールヘッダの改ざんの有無**」です。

&nbsp;&nbsp;&nbsp;このように、ディジタル署名を用いることで「送信者の検証」に加えて「完全性の検証」も行えることを覚えておくと良いでしょう(なお「否認防止」も可能です)。

## 設問3
&nbsp;&nbsp;&nbsp;図7の1行目はMXレコードであり、空欄kにはドメイン`a-sub.n-sha.co.jp`のメールサーバのホスト名を指定します。問題文にある通り、`a-sub.n-sha.co.jp`のメールサーバのホスト名は`mail.x-sha.co.jp`であるため、空欄kは**mail.x-sha.co.jp.**です。末尾に`.`(ドット)を付与することを忘れないでください。

&nbsp;&nbsp;&nbsp;図7の2行目はSPFレコードであり、空欄lにはドメイン`a-sub.n-sha.co.jp`におけるSPFのIPアドレスを設定します。問題文にある通り、メールサーバ(`mail.x-sha.co.jp`)のIPアドレスは`x2.y2.z2.1`であるため、空欄lは**x2.y2.z2.1**です。なお、`x2.y2.z2.2`はSPF検証時に問い合わせ先となるDNSサーバのグローバルIPアドレスです。空欄lには当てはまりません。

&nbsp;&nbsp;&nbsp;空欄mでは、DMARCの`p`タグを設定します。表2にある通り、`p`タグでは「送信側が指定する受信側でのメールの取り扱いに関するポリシ」を設定します。問題分より、受信側で検証に失敗したメールは隔離するポリシとするため、空欄mには**quarantine**を指定します。

&nbsp;&nbsp;&nbsp;空欄mでは、DMARCの`aspf`タグを設定します。表2にある通り、`aspf`タグは「SPF認証の調整パラメタ」です。問題文より、ニュースレターはX社のメールサーバから配信され、Header-FROMにはN社ドメイン名のメールアドレスが、Envelope-FROMにはN社のサブドメイン名のメールアドレスが設定されます。そのため、もし`aspf`タグに`s`(strict)が設定されている場合、Header-FROMとEnvelope-FROMに用いられているFQDNが一致しないため認証に失敗してしまいます。よって、空欄mには組織ドメイン(サブドメイン)が一致していれば認証に成功する**r**(relaxed)を指定します。

## 設問4
&nbsp;&nbsp;&nbsp;ここまでを通して見てきたように、SPF、DKIM及びDMARCを用いることで送信元ドメインを偽るような、いわゆるなりすまし攻撃を防ぐことができます。

&nbsp;&nbsp;&nbsp;これは、裏を返せば、送信元ドメインを偽っていないような攻撃は防ぐことができないと言えます。

&nbsp;&nbsp;&nbsp;例えば、取引先の正規のメールアドレスが`foobar@torihiki.com`である場合を想定します。

&nbsp;&nbsp;&nbsp;この時、攻撃者が送信元メールアドレスを`foobar@torihiki.com`であると詐称した場合は、検証を通してその詐称を検知することができます。

&nbsp;&nbsp;&nbsp;しかしながら、攻撃者が`tor1hiki.com`のような人間が見間違えそうなドメイン名を取得した上で送信ドメイン認証技術の設定を行い、そのドメイン名を用いて送信元メールアドレスを`foobar@tor1hiki.com`のように設定したとします。この場合、送信ドメインの認証においては何ら問題はない(不一致が発生しない)ため、N社メールサーバにおける検証が成功します(なお、このように人が勘違いしそうな、正規のドメイン名に類似したものを利用する攻撃をTyposquattingと言います)。

&nbsp;&nbsp;&nbsp;このように、送信元ドメインを偽らずに攻撃を行うことで、送信ドメインの認証をバイパスすることができると言えます。よって、設問4の答えは「**N社の取引先と似たメールアドレスから送信ドメイン認証技術を利用してメールを送信する。**」であると言えます。

# 問2 セキュリティインシデント対応におけるサイバーセキュリティ情報の活用
## 設問1
### (1)p
### (2)
### (3)
### (4)
## 設問2
### (1)
### (2)
### (3)
### (4)
### (5)

# 問3 標的型攻撃への対応
## 設問1
### (1)
### (2)
## 設問2
## 設問3
### (1)
### (2)
### (3)